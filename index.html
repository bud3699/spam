<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" name="viewport" content="device-width, initial-scale=1.0">
    <title> Spam Budtholomew </title>
    <link href="styles.css" rel="stylesheet" type="text/css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fuzzy+Bubbles:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400..900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Playwrite+AU+TAS:wght@100..400&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Jim+Nightshade&display=swap');



        @font-face {
            font-family: 'Dingbat';
            src: url('BuDingbatsSansPurpose-njmY.ttf') format('truetype');
        }

        @font-face {
            font-family: 'Starry';
            src: url('starrynight.ttf') format('truetype');
        }

        @font-face {
            font-family: 'Chalky';
            src: url('Chalky-1jDeZ.ttf') format('truetype');
        }

        @font-face {
            font-family: 'C64';
            src: url('C64_Pro-STYLE.ttf') format('truetype');
        }

        @font-face {
            font-family: 'polinka';
            src: url('Pollys.ttf') format('truetype');
        }








        .fuzzy-bubbles-regular {
            font-family: "Fuzzy Bubbles", sans-serif;
            font-weight: 400;
            font-style: normal;
        }

        .fuzzy-bubbles-bold {
            font-family: "Fuzzy Bubbles", sans-serif;
            font-weight: 700;
            font-style: normal;
        }

        #leaderboardList {
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: white;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
            background-color: rgba(21, 21, 22, 1);
        }

        th,
        td:nth-child(1) {
            width: 10%;
            background-color: #f2f2f2;
            background-color: rgba(21, 21, 22, 1);
        }

        td:nth-child(2) {
            width: 60%;
            background-color: #f2f2f2;
            background-color: rgba(21, 21, 22, 1);
        }

        td:nth-child(3) {
            width: 30%;
            background-color: #f2f2f2;
            background-color: rgba(21, 21, 22, 1);
        }

        .avatarUpload {
            display: none;
        }


        @keyframes rotateAndScale {
            0% {
                transform: rotate(10deg) scale(1);
            }

            50% {
                transform: rotate(-10deg) scale(1.2);
            }

            100% {
                transform: rotate(10deg) scale(0.8);
            }
        }

        #advert {
            animation: rotateAndScale 4s infinite alternate;
        }



        .wrapper {
            width: 200px;
            height: 60px;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .circle {
            width: 20px;
            height: 20px;
            position: absolute;
            border-radius: 50%;
            background-color: #fff;
            left: 15%;
            transform-origin: 50%;
            animation: circle .5s alternate infinite ease;
        }

        @keyframes circle {
            0% {
                top: 60px;
                height: 5px;
                border-radius: 50px 50px 25px 25px;
                transform: scaleX(1.7);
            }

            40% {
                height: 20px;
                border-radius: 50%;
                transform: scaleX(1);
            }

            100% {
                top: 0%;
            }
        }

        .circle:nth-child(2) {
            left: 45%;
            animation-delay: .2s;
        }

        .circle:nth-child(3) {
            left: auto;
            right: 15%;
            animation-delay: .3s;
        }

        .shadow {
            width: 20px;
            height: 4px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, .5);
            position: absolute;
            top: 62px;
            transform-origin: 50%;
            z-index: -1;
            left: 15%;
            filter: blur(1px);
            animation: shadow .5s alternate infinite ease;
        }

        @keyframes shadow {
            0% {
                transform: scaleX(1.5);
            }

            40% {
                transform: scaleX(1);
                opacity: .7;
            }

            100% {
                transform: scaleX(.2);
                opacity: .4;
            }
        }

        .shadow:nth-child(4) {
            left: 45%;
            animation-delay: .2s
        }

        .shadow:nth-child(5) {
            left: auto;
            right: 15%;
            animation-delay: .3s;
        }

        .wrapper span {
            position: absolute;
            top: 75px;
            font-family: 'Lato';
            font-size: 20px;
            letter-spacing: 12px;
            color: #fff;
            left: -30%;
            white-space: nowrap;
        }

        .loading-overlay-message {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            z-index: 1000;
            opacity: 1;
            transition: opacity 0.5s ease;
        }

        .loading-overlay-message.fade-out {
            opacity: 0;

        }

        .loading-overlay-message.faded-out {
            opacity: 0;
            display: none;
        }

        .loadanyway {
            position: relative;
            top: 200px;
            left: 15%;
            font-size: 16px;
            padding: 10px 20px;
            border-radius: 8px;
            background-color: rgba(21, 21, 22, 1);
            color: white;
            border: none;
            cursor: pointer;

        }
    </style>
</head>

<body>

    <div class="loading-overlay-message">
        <div class="wrapper">
            <div class="circle"></div>
            <div class="circle"></div>
            <div class="circle"></div>
            <div class="shadow"></div>
            <div class="shadow"></div>
            <div class="shadow"></div>
            <span>Loading Messages</span>
            <button class="loadanyway" onclick="loadAnyway()">Load Anyway</button>
        </div>
    </div>

    <div id="aboutme" class="container">
        <div style="position: relative; width: 100%; height: 100%;">
            <a href="https://bud.is-a.dev/" style="text-decoration: none; position: absolute; top: 0; left: 0;">
                <button class="return-button"
                    style="font-size: 16px; padding: 10px 20px; background-color: white; color: black; border: 1px solid #ddd; border-radius: 5px; cursor: pointer; transition: background-color 0.3s;">
                    â†© Return
                </button>
            </a>
        </div>

        <div class="aboutme">
            <form id="discordForm">
                <h1> LEADERBOARD </h1>
                <h2> Spam for first </h2>
                <label for="message">Welcome to the leaderboard, here you will compete to see who can spam the most
                    messages to get first place. The podium leaderboard will display once there is a position for second
                    and first place. Otherwise refer to the full leaderboard. I plan to bring custom avatars to podium
                    leaderboard, however these will only be able to be assigned by me. So when this feature is out, then
                    feel free to dm me an avatar for me to add onto the podium. I created this so my actual leave me a
                    me
                    message didnt get clogged
                    with spam messages of people trying to get first place. soooo. Go nuts everyone :)<br></label><br>
                <label for="avatarUpload" class="custom-file-upload"
                    style="color: black; width: 100px; display: block; margin-left: auto; margin-right: auto; text-align: center;">
                    Custom PFP
                </label>
                <input type="file" id="avatarUpload" name="avatarUpload" accept="image/*" style="display: none;">
                <img id="imagePreview" src="" alt="Image preview"
                    style="display: none; margin-left: auto; margin-right: auto;">
                <input type="text" id="username" name="username" oninput="adjustInput(this)"
                    placeholder="Username here"><br>
                <input type="text" id="message" name="message" oninput="adjustInput(this)"
                    placeholder="Comment here"><br>
                <input type="text" id="code" name="code" oninput="adjustInput(this)"
                    placeholder="Enter your style code">
                <div style="display: flex; justify-content: center;">
                    <input type="styles" value="View Styles" readonly
                        style="max-width: 100px; height: 30px; margin-left: 10px; margin-right: 10px; text-align: center;"onclick="window.open('/spam/styles/', '_blank');">
                    <input type="refresh" value="Refresh Styles" readonly
                        style="max-width: 100px; height: 30px; margin-left: 10px; margin-right: 10px; text-align: center;", onclick="fetchStyles();">
                </div>

                <!--<h2 id="advert"> cool feature coming soon</h2>-->
                <div id="DisplayMessageContainer">
                    <div class="message">
                        <div class="author">
                            <img class="profile-picture">
                            Username
                        </div>
                        <div class="content">Message</div>
                        <div class="timestamp">Time</div>
                    </div>
                </div>
                <input type="submit" value="Send">
            </form>
        </div>
        <div id="podium">
            <div class="place" id="first"></div>
            <div class="place" id="second"></div>
            <div class="place" id="third"></div>
        </div>
        <div id="leaderboardList">
            <h2>Leaderboard</h2>
            <table>
                <thead>
                    <tr>
                        <th>Place</th>
                        <th>Username</th>
                        <th>Score</th>
                    </tr>
                </thead>
                <tbody id="leaderboardEntries"></tbody>
            </table>
        </div>
        <div class="MessagesClass">
            <div id="messageList">
                <h2>Pinned Messages</h2>
                <div id="messageEntriesPinned"></div>
            </div>
        </div>
        <div class="Messagesclass">

            <div id="messageList">
                <h2>Messages</h2>
                <div id="messageEntries"></div>
            </div>

        </div>
        <div>
            .
        </div>

    </div>


</body>
<script>

    let allStyles = [];
    fetchStyles();


    window.onload = function () {
        leaderboardRefresh();
        adjustPodiumHeight();
        fetchMessages();

        var closeButton = document.getElementsByClassName('close-button');
        for (var i = 0; i < closeButton.length; i++) {
            closeButton[i].addEventListener('click', function () {
                this.parentElement.style.display = 'none';
            });
        }

        var reviews = document.getElementsByClassName('review');
        for (var i = 0; i < reviews.length; i++) {
            reviews[i].addEventListener('mouseenter', function (e) {
                var opinion = this.getElementsByClassName('my-opinion')[0];
                var rect = this.getBoundingClientRect();
                opinion.style.left = (e.pageX - rect.left) + 'px';
                opinion.style.top = (e.pageY - rect.top) + 'px';
                opinion.style.display = 'block';
            });
            reviews[i].addEventListener('mouseleave', function () {
                var opinion = this.getElementsByClassName('my-opinion')[0];
                opinion.style.display = 'none';
            });
        }

        setTimeout(function () {
            adjustPodiumHeight();
        }, 4000);
    };

    function loadAnyway() {
        if (confirm('Messages may still be loading!')) {
            const overlay = document.querySelector('.loading-overlay-message');
            overlay.classList.add('fade-out');
            setTimeout(() => {
                overlay.classList.add('faded-out');
            }, 501);
        }
    }

    function updateImagePreview(event) {
        var output = document.getElementById('imagePreview');
        if (event.target.files.length === 0) {
            output.style.display = 'none';
            output.src = '';
            localStorage.removeItem('pfp');
        } else {
            var reader = new FileReader();
            reader.onload = function () {
                output.style.display = 'block';
                output.src = reader.result;
                localStorage.setItem('pfp', reader.result);
            };
            reader.readAsDataURL(event.target.files[0]);
        }
        updateMessage();
    }



    document.getElementById('avatarUpload').addEventListener('change', updateImagePreview);



    function getPodiumHeights() {
        var thirdPlace = document.getElementById("third");
        var secondPlace = document.getElementById("second");
        var firstPlace = document.getElementById("first");

        thirdPlace.style.height = "auto";
        secondPlace.style.height = "auto";
        firstPlace.style.height = "auto";

        var thirdPlaceHeight = thirdPlace.scrollHeight;
        var secondPlaceHeight = secondPlace.scrollHeight;
        var firstPlaceHeight = firstPlace.scrollHeight;

        return {
            thirdPlaceHeight: thirdPlaceHeight,
            secondPlaceHeight: secondPlaceHeight,
            firstPlaceHeight: firstPlaceHeight
        };
    }

    function adjustPodiumHeight() {
        var thirdPlace = document.getElementById("third");
        var secondPlace = document.getElementById("second");
        var firstPlace = document.getElementById("first");
        var podiumHeights = getPodiumHeights();

        if ((podiumHeights.secondPlaceHeight - 50) > podiumHeights.thirdPlaceHeight) {
            if ((podiumHeights.firstPlaceHeight - 50) > podiumHeights.secondPlaceHeight) {
                firstPlace.style.height = podiumHeights.firstPlaceHeight;
                secondPlace.style.height = (podiumHeights.firstPlaceHeight - 50) + "px";
                thirdPlace.style.height = (podiumHeights.firstPlaceHeight - 100) + "px";
            } else {
                firstPlace.style.height = (podiumHeights.secondPlaceHeight + 50) + "px";
                secondPlace.style.height = podiumHeights.secondPlaceHeight + "px";
                thirdPlace.style.height = (podiumHeights.secondPlaceHeight - 50) + "px";
            }
        } else {
            if ((podiumHeights.thirdPlaceHeight + 100) > podiumHeights.firstPlaceHeight) {
                firstPlace.style.height = (podiumHeights.thirdPlaceHeight + 100) + "px";
                secondPlace.style.height = (podiumHeights.thirdPlaceHeight + 50) + "px";
                thirdPlace.style.height = podiumHeights.thirdPlaceHeight + "px";
            } else {
                firstPlace.style.height = podiumHeights.firstPlaceHeight + "px";
                secondPlace.style.height = (podiumHeights.firstPlaceHeight - 50) + "px";
                thirdPlace.style.height = (podiumHeights.firstPlaceHeight - 100) + "px";
            }
        }
    }

    function leaderboardRefresh() {
        var url = "http://budstesting.rf.gd/store/spam_leaderboard.json";
        var corsProxy = "https://corsproxy.io/?";

        url += "?t=" + new Date().getTime();

        fetch(corsProxy + url)
            .then(response => response.json())
            .then(data => {
                //delete data["polinka"];
                var entries = Object.entries(data);
                entries.sort((a, b) => b[1] - a[1]);




                var leaderboardEntries = document.getElementById("leaderboardEntries");
                leaderboardEntries.innerHTML = '';
                var previousScore = null;
                var rank = 0;

                entries.forEach((entry, index) => {
                    if (previousScore !== entry[1]) {
                        rank = index + 1;
                        previousScore = entry[1];
                    }

                    var row = document.createElement("tr");
                    var placeCell = document.createElement("td");
                    placeCell.textContent = rank;
                    var usernameCell = document.createElement("td");
                    usernameCell.textContent = entry[0];
                    var scoreCell = document.createElement("td");
                    scoreCell.textContent = entry[1];

                    row.appendChild(placeCell);
                    row.appendChild(usernameCell);
                    row.appendChild(scoreCell);

                    leaderboardEntries.appendChild(row);
                });


                //here we can start the podium place calculations

                var places = ["first", "second", "third"];
                var currentPlace = [];
                var index = 0;
                var podiumPlaces = {};

                for (var i = 0; i < entries.length; i++) {
                    if (currentPlace.length > 0 && entries[i][1] !== currentPlace[0][1]) {
                        podiumPlaces[places[index]] = createPlace(places[index], currentPlace);
                        currentPlace = [];
                        index++;
                    }
                    if (index >= places.length) {
                        break;
                    }
                    currentPlace.push(entries[i]);
                }
                if (currentPlace.length > 0 && index < places.length) {
                    podiumPlaces[places[index]] = createPlace(places[index], currentPlace);
                }

                var podium = document.getElementById("podium");
                podium.innerHTML = '';
                podium.appendChild(podiumPlaces['second']);
                podium.appendChild(podiumPlaces['first']);
                podium.appendChild(podiumPlaces['third']);



                adjustPodiumHeight();
            });
    }

    function fetchMessages() {
        var url = "http://budstesting.rf.gd/store/spam_messages.json";
        var corsProxy = "https://corsproxy.io/?";

        url += "?t=" + new Date().getTime();

        fetch(corsProxy + url)
            .then(response => response.text())
            .then(data => {
                var messages = data.trim().split('\n');
                var parsedMessages = messages.map(message => JSON.parse(message));
                //var filteredMessages = parsedMessages.filter(message => message.author !== "polinka");
                displayMessages(parsedMessages);
            })
            .catch(error => console.error('Error fetching messages:', error));
    }

    var lastDisplayedTimestamp = 0;
    let MessageLimit = 5

    function displayMessages(messages) {
        var messageEntries = document.getElementById("messageEntries");
        var messageEntriesPinned = document.getElementById("messageEntriesPinned");

        messages.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));

        messages.forEach((message, index) => {
            setTimeout(() => {
                var messageTimestamp = new Date(message.timestamp).getTime();

                if (messageTimestamp > lastDisplayedTimestamp && !message.content.includes("boyfriend")) {
                    var messageDiv = document.createElement("div");
                    messageDiv.className = "message";
                    messageDiv.id = `${message.id}`;


                    let styleCodeMatch = message.content.match(/!style=(\w+)!$/);
                    let styles = styleCodeMatch ? getStyleFromCode(styleCodeMatch[1]) : getAuthorStyles(message.author);

                    if (styles.backgroundImage) messageDiv.style.backgroundImage = styles.backgroundImage;
                    if (styles.backgroundColor) messageDiv.style.backgroundColor = styles.backgroundColor;
                    if (styles.color) messageDiv.style.color = styles.color;
                    if (styles.fontFamily) messageDiv.style.fontFamily = styles.fontFamily;
                    if (styles.fontSize) messageDiv.style.fontSize = styles.fontSize;

                    if (message.id === "1252406394347327492") {
                        //messageDiv.style.backgroundColor = "#c12424";
                        //messageDiv.style.backgroundColor = "#101027";
                        messageDiv.style.fontFamily = "'Chalky', cursive";
                        messageDiv.style.backgroundImage = "linear-gradient(to bottom, black, #0c1445, #38285c)";

                        messageDiv.style.position = "relative";
                        messageDiv.style.overflow = "hidden";
                        messageDiv.style.zIndex = "1";

                        const dots = document.createElement("div");
                        dots.style.content = '""';
                        dots.style.position = "absolute";
                        dots.style.top = "0";
                        dots.style.left = "0";
                        dots.style.width = "100%";
                        dots.style.height = "100%";
                        dots.style.backgroundImage = "url('https://i.gifer.com/WG8P.gif')";
                        dots.style.backgroundSize = "100px 100px";

                        messageDiv.appendChild(dots);
                        //messageDiv.style.backgroundImage = "url('https://i.gifer.com/WG8P.gif')";


                    }/*
                    if (message.author === "polinka") {
                        messageDiv.style.backgroundImage = "linear-gradient(to bottom, #FFA3D7, #FFC6E6)";

                        /*
                        messageDiv.style.position = "relative";
                        messageDiv.style.overflow = "hidden"; 
                        messageDiv.style.zIndex = "1"; 
    
                        const dots = document.createElement("div");
                        dots.style.content = '""';
                        dots.style.position = "absolute";
                        dots.style.top = "0";
                        dots.style.left = "0";
                        dots.style.width = "100%";
                        dots.style.height = "100%";
                        dots.style.backgroundImage = "radial-gradient(circle, rgba(255, 255, 255, 0.5) 10%, transparent 10%)";
                        dots.style.backgroundSize = "10px 10px";
    
                        messageDiv.appendChild(dots);
                        
                        messageDiv.style.color = "#9E2168";
                        messageDiv.style.fontStyle = "italic";
                        messageDiv.style.fontFamily = "'Fuzzy Bubbles', sans-serif";
                    }
                    */


                    var authorDiv = document.createElement("div");
                    authorDiv.className = "author";

                    switch (message.author) {
                        case "chisenoa":
                            var authorLink = document.createElement("a");
                            authorLink.href = "https://mindlabor.dev/";
                            authorLink.textContent = message.author;
                            authorDiv.appendChild(authorLink);
                            break;
                        case "MikeTheTech":
                            var authorLink = document.createElement("a");
                            authorLink.href = "https://mikethetech.com/";
                            authorLink.textContent = message.author;
                            authorLink.style.color = "grey";
                            authorLink.style.textDecoration = "none";
                            authorDiv.appendChild(authorLink);
                            break;

                        default:
                            authorDiv.textContent = message.author;
                    }
                    if (message.id === "1252406394347327492") {
                        authorDiv.style.zIndex = "2";
                    }


                    if (message.author === "kamil") {
                        var pfpImg = document.createElement("img");
                        pfpImg.className = "profile-picture";
                        pfpImg.src = "https://cdn.discordapp.com/avatars/622952747309989918/b51eb8f6a544010a94ada0330b105bd1?size=1024";
                        pfpImg.alt = `${message.author}'s profile picture`;
                        authorDiv.insertBefore(pfpImg, authorDiv.firstChild);
                    } else if (message.id === "1253107303654359202") {
                        var pfpImg = document.createElement("img");
                        pfpImg.className = "profile-picture";
                        pfpImg.src = "https://cdn.discordapp.com/avatars/549421814858645515/cfa43a178bfcff3a38fae0f926ba719e?size=1024";
                        pfpImg.alt = `${message.author}'s profile picture`;
                        authorDiv.insertBefore(pfpImg, authorDiv.firstChild);
                    } else if (message.id === "1252406394347327492") {
                        var pfpImg = document.createElement("img");
                        pfpImg.className = "profile-picture";
                        pfpImg.src = "https://static.wixstatic.com/media/6bfb3b_10f9e56824ac482495a7000825a14d87~mv2.gif";
                        pfpImg.alt = `${message.author}'s profile picture`;
                        authorDiv.insertBefore(pfpImg, authorDiv.firstChild);
                    } else if (message.pfp !== 'none') {
                        var pfpImg = document.createElement("img");
                        pfpImg.className = "profile-picture";
                        pfpImg.src = message.pfp;
                        pfpImg.alt = `${message.author}'s profile picture`;
                        authorDiv.insertBefore(pfpImg, authorDiv.firstChild);
                    }


                    messageDiv.appendChild(authorDiv);

                    var contentDiv = document.createElement("div");
                    if (message.id === "1252406394347327492") {
                        contentDiv.style.zIndex = "2";
                    } else if (message.author === "MikeTheTech") {
                        contentDiv.style.margin = "10px"
                    }

                    contentDiv.className = "content";
                    contentDiv.textContent = message.content.replace(/!style=\w+!$/, '');
                    messageDiv.appendChild(contentDiv);

                    var timestampDiv = document.createElement("div");
                    if (message.id === "1252406394347327492") {
                        timestampDiv.style.zIndex = "2";
                    }

                    timestampDiv.className = "timestamp";
                    timestampDiv.textContent = formatTimestamp(message.timestamp);
                    messageDiv.appendChild(timestampDiv);


                    if (message.reactions.some(reaction => reaction === "\ud83d\udccc")) {

                        messageEntriesPinned.appendChild(messageDiv);

                        console.log(message.reactions);

                    } else {
                        messageEntries.insertBefore(messageDiv, messageEntries.firstChild);
                    }


                    lastDisplayedTimestamp = messageTimestamp;
                }

                if (index === messages.length - 1) {
                    MessageLimit = 1
                    const overlay = document.querySelector('.loading-overlay-message');
                    overlay.classList.add('fade-out');
                    setTimeout(() => {
                        overlay.classList.add('faded-out');
                    }, 501);
                }

            }, index * MessageLimit);

        });

        MessageLimit = 1

    }







    function formatTimestamp(timestamp) {
        // Convert timestamp to local time
        var localTime = new Date(timestamp).toLocaleString();
        return localTime;
    }



    window.addEventListener("resize", adjustPodiumHeight);
    window.addEventListener("resize", leaderboardRefresh);
    //setInterval(adjustPodiumHeight, 10000);
    setInterval(leaderboardRefresh, 10000);
    setInterval(fetchMessages, 15000);

    function createPlace(place, entries) {
        var div = document.createElement("div");
        div.id = place;
        div.className = "place";

        var namesDiv = document.createElement("div");
        namesDiv.className = "names";
        entries.forEach(entry => {
            var name = document.createElement("div");
            name.className = "name";
            name.textContent = entry[0];
            namesDiv.appendChild(name);
        });
        div.appendChild(namesDiv);

        var score = document.createElement("div");
        score.className = "score";
        score.textContent = entries[0][1];
        div.appendChild(score);

        return div;
    }

    var username = localStorage.getItem('username');
    if (username) {
        document.getElementById('username').value = username;
    }
    var pfp = localStorage.getItem('pfp');
    if (pfp) {
        var pfpImg = document.getElementById('imagePreview');
        pfpImg.src = pfp;
    }
    var messageStyle = localStorage.getItem('MessageStyle');
    if (messageStyle) {
        document.getElementById('code').value = messageStyle;
    }


    function adjustInput(input) {
        input.style.width = ((input.value.length) * 7) + 'px';
        if (input.id === 'username') {
            localStorage.setItem('username', input.value);
        }
    }

    //let webhookUrl = 'https://ptb.discord.com/api/webhooks/1252307627099295805/VnI0Msvi1_RrWRh4TjtHTVtwMfGeUjpj5kTmLCbfdVelV45tMffrPsejZ0wnXaKR72FV';
    let form = document.getElementById('discordForm');




    form.addEventListener('submit', function (event) {
        event.preventDefault();
        let username = document.getElementById('username').value;
        let message = document.getElementById('message').value;
        let style = document.getElementById('code').value;
        let avatarUpload = document.getElementById('avatarUpload').files[0];
        let messageToSend = username + " !style=" + style + "!";

        if (!username || !message) {
            alert('Please enter both a username and a message.');
            return;
        }

        let formData = new FormData();
        formData.append('username', username);
        formData.append('content', messageToSend);

        let originalWebhookUrl = 'https://ptb.discord.com/api/webhooks/1252307627099295805/VnI0Msvi1_RrWRh4TjtHTVtwMfGeUjpj5kTmLCbfdVelV45tMffrPsejZ0wnXaKR72FV';
        let avatarWebhookUrl = 'https://ptb.discord.com/api/webhooks/1252769944983048315/hbKkofzYg7NLW9ou1b9t4AThyo8svkG1Opc8MPL57yHQJLOL8OTyxwJ7odoZd9BROR5x';

        if (avatarUpload) {
            formData.append('file', avatarUpload, 'avatar.jpg');

            sendWebhook(avatarWebhookUrl, formData);
        } else {
            sendWebhook(originalWebhookUrl, formData);
        }
    });

    function sendWebhook(webhookUrl, formData) {
        document.getElementById('message').value = '';
        updateMessage()
        let requestOptions = {
            method: 'POST',
            body: formData

        };

        fetch(webhookUrl, requestOptions)
            .then(response => {
                if (response.ok) {
                    console.log('Message sent!');
                } else {
                    console.error('Failed to send message:', response);
                }
            })
            .catch(error => console.error('Error:', error));
    }


    document.addEventListener('DOMContentLoaded', function () {
        setTimeout(function () {
            var storedPfp = localStorage.getItem('pfp');
            if (storedPfp) {
                var imagePreview = document.getElementById('imagePreview');
                if (imagePreview) {
                    imagePreview.src = storedPfp;
                    imagePreview.style.display = 'block';
                    fetch(storedPfp)
                        .then(res => res.blob())
                        .then(blob => {
                            const file = new File([blob], 'avatar.jpg', { type: 'image/jpeg' });
                            const dataTransfer = new DataTransfer();
                            dataTransfer.items.add(file);
                            document.getElementById('avatarUpload').files = dataTransfer.files;
                        });
                }
            }
        }, 2000);
    });



    function FileListItems(files) {
        var b = new ClipboardEvent("").clipboardData || new DataTransfer();
        for (var i = 0, len = files.length; i < len; i++) b.items.add(files[i]);
        return b.files;
    }


    //Author Div Function

    function getAuthorStyles(author) {
        let styles = {
            backgroundImage: '',
            backgroundColor: '',
            color: '',
            fontFamily: '',
            fontSize: ''
        };

        switch (author) {
            case "Lauren":
                styles.backgroundImage = "linear-gradient(to bottom, #fbdffb, #d9ead3)";
                styles.color = "black";
                styles.fontFamily = "'Playwrite AU TAS', cursive";
                break;
            case "MikeTheTech":
                styles.backgroundImage = "linear-gradient(to right, black, #23bc6a, black)";
                styles.fontFamily = "'C64', cursive";
                styles.fontSize = "15px";
                break;
            case "mai c:":
                styles.backgroundImage = "linear-gradient(to bottom, #f0b9d0, #faebc3, #fcb95b)";
                styles.color = "black";
                break;
            case "chisenoa":
                styles.backgroundColor = "#c58cff";
                styles.color = "black";
                break;
            case "polinka":
                styles.backgroundImage = "linear-gradient(to bottom, #FFA3D7, #FFC6E6)";
                styles.color = "#9E2168";
                styles.fontStyle = "italic";
                styles.fontFamily = "'Fuzzy Bubbles', sans-serif";
                break;
            case "polyleftene":
                styles.backgroundColor = "#FDC443";
                styles.color = "black";
                break;
            case "17 ON TOP !":
                styles.backgroundImage = "linear-gradient(to bottom, #FFD7D7, #FFFFFF)";
                styles.color = "black";
                break;
            case "kamil":
                styles.backgroundImage = "linear-gradient(-45deg, #3c006e, #000000, #80146e)";
                styles.fontFamily = "'Dingbat', sans-serif";
                styles.color = "white";
                break;
            case "Thae":
                styles.backgroundImage = "linear-gradient(45deg, #8294b4, #000000, #00097a)";
                styles.color = "white";
                styles.fontFamily = "'Cinzel', serif";
                break;
            case "Tayy":
                styles.backgroundImage = "linear-gradient(-45deg, #80146e, #000000, #3c006e)";
                styles.color = "white";
                styles.fontFamily = "'Cinzel', serif";
                break;
        }

        return styles;
    }

    function applyStylesFromCode(code) {
        let styles = {
            backgroundImage: '',
            backgroundColor: '',
            color: '',
            fontFamily: '',
            fontSize: ''
        };

        switch (code) {
            case "Style_id_1":
                styles.backgroundImage = "linear-gradient(to bottom, #fbdffb, #d9ead3)";
                styles.color = "black";
                styles.fontFamily = "'Playwrite AU TAS', cursive";
                break;
            case "Style_id_2":
                styles.backgroundImage = "linear-gradient(to right, black, #23bc6a, black)";
                styles.fontFamily = "'C64', cursive";
                styles.fontSize = "15px";
                break;

        }

        return styles;
    }

    function getStyleFromCode(code) {
        console.log('allStyles:', allStyles);
        if (typeof allStyles !== 'object' || allStyles === null) {
            console.error('allStyles is not an object');
            return null;
        }

        const style = allStyles[code];
        if (!style) {
            console.warn(`No style found for code: ${code}`);
            return null;
        }

        return {
            backgroundImage: style.colors.length > 1 ? `linear-gradient(${style.gradientDirection}, ${style.colors.join(', ')})` : '',
            backgroundColor: style.colors.length === 1 ? style.colors[0] : '',
            color: style.fontColor,
            fontFamily: style.fontFamily,
            fontSize: style.fontSize || '' 
        };
    }





    async function fetchStyles() {
        const timestamp = new Date().getTime();
        const url = `https://corsproxy.io/?${encodeURIComponent('http://budstesting.rf.gd/store/all_styles.json')}?t=${timestamp}`;

        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            allStyles = await response.json();

            updateMessage()
        } catch (error) {
            console.error('Error fetching styles:', error);
        }
    }






    const usernameInput = document.getElementById('username');
    const messageInput = document.getElementById('message');
    const styleInput = document.getElementById('code')
    const messageContainers = document.getElementById('DisplayMessageContainer');



    // Listen for input changes
    usernameInput.addEventListener('input', updateMessage);
    messageInput.addEventListener('input', updateMessage);
    styleInput.addEventListener('input', updateMessage);

    function updateMessage() {
        const username = usernameInput.value || 'John/Jane Doe';
        console.log(username);
        const message = messageInput.value || 'Your message goes here';
        const StyleCode = styleInput.value || 'NoStyleCode';

        const storedImage = localStorage.getItem('pfp');
        const profilePictureSrc = storedImage || '';

        let styles;

        if (StyleCode === 'NoStyleCode') {
            styles = getAuthorStyles(username);
            localStorage.setItem('MessageStyle', '');
        } else {
            styles = getStyleFromCode(StyleCode);
            console.log(styles)
            // styles = applyStylesFromCode(StyleCode) || 
            localStorage.setItem('MessageStyle', StyleCode);
        }

        const messageHTML = `
        <div class="message" style="animation: none; ${styles.backgroundImage ? `background-image: ${styles.backgroundImage};` : ''} ${styles.backgroundColor ? `background-color: ${styles.backgroundColor};` : ''} ${styles.color ? `color: ${styles.color};` : ''} ${styles.fontFamily ? `font-family: ${styles.fontFamily};` : ''} ${styles.fontSize ? `font-size: ${styles.fontSize};` : ''}">
            <div class="author">
                ${profilePictureSrc ? `<img class="profile-picture" src="${profilePictureSrc}">` : ''}
                ${username}
            </div>
            <div class="content">${message.replace(/!style=\w+!$/, '')}</div>
            <div class="timestamp">${new Date().toLocaleString()}</div>
        </div>
    `;

        messageContainers.innerHTML = messageHTML;
    }
    //   */


    updateMessage()

</script>

</html>
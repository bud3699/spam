<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" name="viewport" content="device-width, initial-scale=1.0">
    <title> Spam Budtholomew </title>
    <link href="styles.css" rel="stylesheet" type="text/css">
    <style>
        #leaderboardList {
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: white;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
            background-color: rgba(21, 21, 22, 1);
        }

        th,
        td:nth-child(1) {
            width: 10%;
            background-color: #f2f2f2;
            background-color: rgba(21, 21, 22, 1);
        }

        td:nth-child(2) {
            width: 60%;
            background-color: #f2f2f2;
            background-color: rgba(21, 21, 22, 1);
        }

        td:nth-child(3) {
            width: 30%;
            background-color: #f2f2f2;
            background-color: rgba(21, 21, 22, 1);
        }
    </style>
</head>

<body>
    <div id="aboutme" class="container">
        <div style="position: relative; width: 100%; height: 100%;">
            <a href="https://bud.is-a.dev/" style="text-decoration: none; position: absolute; top: 0; left: 0;">
                <button class="return-button"
                    style="font-size: 16px; padding: 10px 20px; background-color: white; color: black; border: 1px solid #ddd; border-radius: 5px; cursor: pointer; transition: background-color 0.3s;">
                    â†© Return
                </button>
            </a>
        </div>

        <div class="aboutme">
            <form id="discordForm">
                <h1> LEADERBOARD </h1>
                <h2> Spam for first </h2>
                <label for="message">Welcome to the leaderboard, here you will compete to see who can spam the most
                    messages to get first place. The podium leaderboard will display once there is a position for second
                    and first place. Otherwise refer to the full leaderboard. I plan to bring custom avatars to podium
                    leaderboard, however these will only be able to be assigned by me. So when this feature is out, then
                    feel free to dm me an avatar for me to add onto the podium. I created this so my actual leave me a
                    me
                    message didnt get clogged
                    with spam messages of people trying to get first place. soooo. Go nuts everyone :)</label><br>
                <input type="text" id="username" name="username" oninput="adjustInput(this)"
                    placeholder="Username here"><br>
                <input type="text" id="message" name="message" oninput="adjustInput(this)"
                    placeholder="Comment here"><br>
                <input type="submit" value="Send">
            </form>
        </div>
        <div id="podium">
            <div class="place" id="first"></div>
            <div class="place" id="second"></div>
            <div class="place" id="third"></div>
        </div>
        <div id="leaderboardList">
            <h2>Leaderboard</h2>
            <table>
                <thead>
                    <tr>
                        <th>Place</th>
                        <th>Username</th>
                        <th>Score</th>
                    </tr>
                </thead>
                <tbody id="leaderboardEntries"></tbody>
            </table>
        </div>

        <div class="Messagesclass">
            <div id="messageList">
                <h2>Messages</h2>
                <div id="messageEntries"></div>
            </div>

        </div>
        <div>
            .
        </div>

    </div>


</body>
<script>
    window.onload = function () {
        leaderboardRefresh();
        adjustPodiumHeight();
        fetchMessages();

        var closeButton = document.getElementsByClassName('close-button');
        for (var i = 0; i < closeButton.length; i++) {
            closeButton[i].addEventListener('click', function () {
                this.parentElement.style.display = 'none';
            });
        }

        var reviews = document.getElementsByClassName('review');
        for (var i = 0; i < reviews.length; i++) {
            reviews[i].addEventListener('mouseenter', function (e) {
                var opinion = this.getElementsByClassName('my-opinion')[0];
                var rect = this.getBoundingClientRect();
                opinion.style.left = (e.pageX - rect.left) + 'px';
                opinion.style.top = (e.pageY - rect.top) + 'px';
                opinion.style.display = 'block';
            });
            reviews[i].addEventListener('mouseleave', function () {
                var opinion = this.getElementsByClassName('my-opinion')[0];
                opinion.style.display = 'none';
            });
        }

        setTimeout(function () {
            adjustPodiumHeight();
        }, 4000);
    };

    function getPodiumHeights() {
        var thirdPlace = document.getElementById("third");
        var secondPlace = document.getElementById("second");
        var firstPlace = document.getElementById("first");

        thirdPlace.style.height = "auto";
        secondPlace.style.height = "auto";
        firstPlace.style.height = "auto";

        var thirdPlaceHeight = thirdPlace.scrollHeight;
        var secondPlaceHeight = secondPlace.scrollHeight;
        var firstPlaceHeight = firstPlace.scrollHeight;

        return {
            thirdPlaceHeight: thirdPlaceHeight,
            secondPlaceHeight: secondPlaceHeight,
            firstPlaceHeight: firstPlaceHeight
        };
    }

    function adjustPodiumHeight() {
        var thirdPlace = document.getElementById("third");
        var secondPlace = document.getElementById("second");
        var firstPlace = document.getElementById("first");
        var podiumHeights = getPodiumHeights();

        if ((podiumHeights.secondPlaceHeight - 50) > podiumHeights.thirdPlaceHeight) {
            if ((podiumHeights.firstPlaceHeight - 50) > podiumHeights.secondPlaceHeight) {
                firstPlace.style.height = podiumHeights.firstPlaceHeight;
                secondPlace.style.height = (podiumHeights.firstPlaceHeight - 50) + "px";
                thirdPlace.style.height = (podiumHeights.firstPlaceHeight - 100) + "px";
            } else {
                firstPlace.style.height = (podiumHeights.secondPlaceHeight + 50) + "px";
                secondPlace.style.height = podiumHeights.secondPlaceHeight + "px";
                thirdPlace.style.height = (podiumHeights.secondPlaceHeight - 50) + "px";
            }
        } else {
            if ((podiumHeights.thirdPlaceHeight + 100) > podiumHeights.firstPlaceHeight) {
                firstPlace.style.height = (podiumHeights.thirdPlaceHeight + 100) + "px";
                secondPlace.style.height = (podiumHeights.thirdPlaceHeight + 50) + "px";
                thirdPlace.style.height = podiumHeights.thirdPlaceHeight + "px";
            } else {
                firstPlace.style.height = podiumHeights.firstPlaceHeight + "px";
                secondPlace.style.height = (podiumHeights.firstPlaceHeight - 50) + "px";
                thirdPlace.style.height = (podiumHeights.firstPlaceHeight - 100) + "px";
            }
        }
    }

    function leaderboardRefresh() {
        var url = "http://budstesting.rf.gd/store/spam_leaderboard.json";
        var corsProxy = "https://corsproxy.io/?";

        url += "?t=" + new Date().getTime();

        fetch(corsProxy + url)
            .then(response => response.json())
            .then(data => {
                var entries = Object.entries(data);
                entries.sort((a, b) => b[1] - a[1]);



                var leaderboardEntries = document.getElementById("leaderboardEntries");
                leaderboardEntries.innerHTML = '';
                var previousScore = null;
                var rank = 0;

                entries.forEach((entry, index) => {
                    if (previousScore !== entry[1]) {
                        rank = index + 1;
                        previousScore = entry[1];
                    }

                    var row = document.createElement("tr");
                    var placeCell = document.createElement("td");
                    placeCell.textContent = rank;
                    var usernameCell = document.createElement("td");
                    usernameCell.textContent = entry[0];
                    var scoreCell = document.createElement("td");
                    scoreCell.textContent = entry[1];

                    row.appendChild(placeCell);
                    row.appendChild(usernameCell);
                    row.appendChild(scoreCell);

                    leaderboardEntries.appendChild(row);
                });


                //here we can start the podium place calculations

                var places = ["first", "second", "third"];
                var currentPlace = [];
                var index = 0;
                var podiumPlaces = {};

                for (var i = 0; i < entries.length; i++) {
                    if (currentPlace.length > 0 && entries[i][1] !== currentPlace[0][1]) {
                        podiumPlaces[places[index]] = createPlace(places[index], currentPlace);
                        currentPlace = [];
                        index++;
                    }
                    if (index >= places.length) {
                        break;
                    }
                    currentPlace.push(entries[i]);
                }
                if (currentPlace.length > 0 && index < places.length) {
                    podiumPlaces[places[index]] = createPlace(places[index], currentPlace);
                }

                var podium = document.getElementById("podium");
                podium.innerHTML = '';
                podium.appendChild(podiumPlaces['second']);
                podium.appendChild(podiumPlaces['first']);
                podium.appendChild(podiumPlaces['third']);



                adjustPodiumHeight();
            });
    }

    function fetchMessages() {
        var url = "http://budstesting.rf.gd/store/spam_messages.json";
        var corsProxy = "https://corsproxy.io/?";

        url += "?t=" + new Date().getTime();

        fetch(corsProxy + url)
            .then(response => response.text()) 
            .then(data => {
                var messages = data.trim().split('\n');
                var parsedMessages = messages.map(message => JSON.parse(message));
                displayMessages(parsedMessages);
            })
            .catch(error => console.error('Error fetching messages:', error));
    }

    var lastDisplayedTimestamp = 0; 

    function displayMessages(messages) {
        var messageEntries = document.getElementById("messageEntries");


        messages.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));

        messages.forEach(message => {
            var messageTimestamp = new Date(message.timestamp).getTime();

            if (messageTimestamp > lastDisplayedTimestamp && !message.content.includes("boyfriend")) {
                var messageDiv = document.createElement("div");
                messageDiv.className = "message";

                if (message.author === "Lauren") {
                    messageDiv.style.backgroundColor = "pink";
                    messageDiv.style.color = "black";
                }
                if (message.author === "MikeTheTech") {
                    messageDiv.style.backgroundColor = "#23bc6a";
                }
                if (message.author === "budtholomew") {
                    messageDiv.style.backgroundColor = "#c12424";
                }
                if (message.author === "mai c:") {
                    messageDiv.style.backgroundColor = "#f0b9d0";
                    messageDiv.style.color = "black";
                }
                if (message.author === "chisenoa") {
                    messageDiv.style.backgroundColor = "#c58cff";
                    messageDiv.style.color = "black";
                }

                var authorDiv = document.createElement("div");
                authorDiv.className = "author";
                authorDiv.textContent = message.author;
                messageDiv.appendChild(authorDiv);

                var contentDiv = document.createElement("div");
                contentDiv.className = "content";
                contentDiv.textContent = message.content;
                messageDiv.appendChild(contentDiv);

                var timestampDiv = document.createElement("div");
                timestampDiv.className = "timestamp";
                timestampDiv.textContent = formatTimestamp(message.timestamp);
                messageDiv.appendChild(timestampDiv);

                messageEntries.insertBefore(messageDiv, messageEntries.firstChild);

                lastDisplayedTimestamp = messageTimestamp;
            }
        });
    }






    function formatTimestamp(timestamp) {
        // Convert timestamp to local time
        var localTime = new Date(timestamp).toLocaleString();
        return localTime;
    }



    window.addEventListener("resize", adjustPodiumHeight);
    window.addEventListener("resize", leaderboardRefresh);
    //setInterval(adjustPodiumHeight, 10000);
    setInterval(leaderboardRefresh, 10000);
    setInterval(fetchMessages, 10000);

    function createPlace(place, entries) {
        var div = document.createElement("div");
        div.id = place;
        div.className = "place";

        var namesDiv = document.createElement("div");
        namesDiv.className = "names";
        entries.forEach(entry => {
            var name = document.createElement("div");
            name.className = "name";
            name.textContent = entry[0];
            namesDiv.appendChild(name);
        });
        div.appendChild(namesDiv);

        var score = document.createElement("div");
        score.className = "score";
        score.textContent = entries[0][1];
        div.appendChild(score);

        return div;
    }

    var username = localStorage.getItem('username');
    if (username) {
        document.getElementById('username').value = username;
    }

    function adjustInput(input) {
        input.style.width = ((input.value.length) * 7) + 'px';
        if (input.id === 'username') {
            localStorage.setItem('username', input.value);
        }
    }

    let webhookUrl = 'https://ptb.discord.com/api/webhooks/1252307627099295805/VnI0Msvi1_RrWRh4TjtHTVtwMfGeUjpj5kTmLCbfdVelV45tMffrPsejZ0wnXaKR72FV';
    let form = document.getElementById('discordForm');

    form.addEventListener('submit', function (event) {
        event.preventDefault();
        let username = document.getElementById('username').value;
        let message = document.getElementById('message').value;

        if (!username || !message) {
            alert('Please enter both a username and a message.');
            return;
        }

        let formData = new FormData();
        formData.append('username', username);
        formData.append('content', message);

        let requestOptions = {
            method: 'POST',
            body: formData
        };

        fetch(webhookUrl, requestOptions)
            .then(response => {
                console.log('Message sent!');
                document.getElementById('message').value = '';
            })
            .catch(error => console.error('Error:', error));
        leaderboardRefresh();
    });
</script>

</html>